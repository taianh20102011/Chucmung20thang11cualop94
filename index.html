<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tri √¢n Th·∫ßy C√¥ 20/11 ‚Äî L·ªõp 9/4</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700;900&display=swap" rel="stylesheet">
<style>
  :root{--bg:#0b1220;--card:#fff;--accent:#ff6b81}
  *{box-sizing:border-box}
  body{margin:0;font-family:'Poppins',system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#061021 0%, #0b1630 60%);color:#fff;min-height:100vh;}
  header{position:fixed;left:0;right:0;top:0;display:flex;justify-content:space-between;align-items:center;padding:12px 20px;z-index:30}
  .brand{font-weight:700;letter-spacing:0.6px}
  .controls{display:flex;gap:10px;align-items:center}
  .btn{background:rgba(255,255,255,0.08);border:0;padding:8px 12px;border-radius:10px;color:#fff;cursor:pointer}
  main{padding-top:84px}

  /* LANDING */
  .landing{min-height:100vh;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
  .hero{width:100%;max-width:1100px;padding:40px;text-align:center}
  .heart-wrap{display:flex;align-items:center;justify-content:center;flex-direction:column}
  svg.heart{width:360px;height:360px;overflow:visible}
  .hero h1{font-size:28px;margin:18px 0 6px}
  .hero p{opacity:0.9}

  /* Card / letter */
  .card-area{margin-top:28px;display:flex;gap:18px;justify-content:center}
  .letter{width:320px;height:200px;perspective:1200px}
  .envelope{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .8s cubic-bezier(.2,.9,.3,1);cursor:pointer}
  .envelope.hover{transform:translateY(-10px)}
  .envelope.open{transform:rotateX(-12deg) translateY(-40px) scale(1.02)}
  .env-front{position:absolute;left:0;right:0;top:0;bottom:0;background:linear-gradient(180deg,#fff,#f3f3f3);border-radius:8px;box-shadow:0 8px 30px rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;color:#222;padding:18px}
  .env-inner{position:absolute;inset:12px;border-radius:6px;padding:18px;background:linear-gradient(180deg,#fff 0,#fff 100%);transform:translateZ(-40px)}
  .env-stamp{position:absolute;right:12px;top:12px;font-weight:700;color:#333}
  .envelope .peek{position:absolute;left:24px;right:24px;top:30px;height:48px;background:linear-gradient(90deg,#ffefc6,#fff);border-radius:6px;display:flex;align-items:center;justify-content:center;color:#333;font-weight:600;transform-origin:center;}

  /* Teachers list modal */
  .teachers-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(0deg,rgba(3,6,12,.6),rgba(3,6,12,.85));z-index:60;backdrop-filter:blur(4px);visibility:hidden;opacity:0;transition:all .25s}
  .teachers-modal.show{visibility:visible;opacity:1}
  .modal-card{background:linear-gradient(180deg,#fff,#f8f8f8);color:#111;padding:18px;border-radius:12px;max-width:920px;width:92%;box-shadow:0 12px 40px rgba(0,0,0,.5)}
  .teacher-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .teacher-item{background:#fff;border-radius:10px;padding:10px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:8px}
  .teacher-item img{width:100%;height:120px;object-fit:cover;border-radius:8px}
  .close-x{position:absolute;right:18px;top:18px;cursor:pointer}

  /* Teacher page */
  section.teacher{min-height:100vh;padding:80px 24px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)}
  .teacher-header{display:flex;gap:18px;align-items:center;max-width:1000px;margin:0 auto}
  .teacher-header img{width:160px;height:160px;border-radius:12px;object-fit:cover;box-shadow:0 8px 30px rgba(0,0,0,.45)}
  .teacher-body{max-width:1000px;margin:26px auto;display:grid;grid-template-columns:1fr 360px;gap:20px}
  .gallery{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  .gallery img{width:100%;height:220px;object-fit:cover;border-radius:12px;opacity:0;transform:translateY(18px);transition:all .6s}
  .gallery img.visible{opacity:1;transform:none}
  .messages{background:rgba(255,255,255,0.03);padding:12px;border-radius:10px;height:520px;overflow:auto}
  .msg{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));padding:10px;border-radius:8px;margin-bottom:8px}
  .msg b{display:block}
  .form{margin-top:12px;display:flex;flex-direction:column;gap:8px}
  input,textarea{width:100%;padding:8px;border-radius:8px;border:0;background:rgba(255,255,255,0.04);color:#fff}
  .submit{background:linear-gradient(90deg,var(--accent),#ff9db0);border:0;padding:10px;border-radius:8px;color:#111;font-weight:700;cursor:pointer}

  /* fireworks canvas */
  canvas#fw{position:fixed;inset:0;pointer-events:none;z-index:20}
  audio{display:none}

  footer{padding:18px;text-align:center;color:rgba(255,255,255,0.6)}

  @media(max-width:900px){.teacher-body{grid-template-columns:1fr} .teacher-header{flex-direction:column;align-items:center}}
</style>
</head>
<body>
<header>
  <div class="brand">L·ªõp 9/4 ‚Äî Tri √¢n Th·∫ßy C√¥ 20/11</div>
  <div class="controls">
    <button class="btn" id="musicToggle">Nh·∫°c n·ªÅn ‚ñ∂</button>
    <button class="btn" id="openTeachers">Danh s√°ch Th·∫ßy C√¥</button>
  </div>
</header>
<canvas id="fw"></canvas>
<main>
  <section class="landing" id="landing">
    <div class="hero">
      <div class="heart-wrap">
        <!-- SVG heart with text-path to draw letters along path -->
        <svg class="heart" viewBox="0 0 200 200" aria-hidden>
          <defs>
            <path id="heartPath" d="M100 30 C120 5,170 20,170 65 C170 110,100 150,100 150 C100 150,30 110,30 65 C30 20,80 5,100 30 Z" />
          </defs>
          <text font-family="Poppins" font-weight="700" font-size="6">
            <textPath id="tpath" xlink:href="#heartPath" startOffset="0%">
              Ch√∫c m·ª´ng ng√†y Nh√† Gi√°o Vi·ªát Nam 20/11 ‚Äî Th√¢n qu√Ω t·ª´ l·ªõp 9/4 ‚Ä¢ Ch√∫c th·∫ßy c√¥ s·ª©c kh·ªèe ‚Ä¢ Th·∫ßy c√¥ l√† ng∆∞·ªùi truy·ªÅn c·∫£m h·ª©ng ‚Ä¢
            </textPath>
          </text>
          <path id="strokeHeart" d="M100 30 C120 5,170 20,170 65 C170 110,100 150,100 150 C100 150,30 110,30 65 C30 20,80 5,100 30 Z" stroke="rgba(255,107,129,0.95)" stroke-width="2.6" fill="transparent" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h1>Tri √¢n Th·∫ßy C√¥ ‚Äî L·ªõp 9/4</h1>
        <p>Ch√∫c m·ª´ng Ng√†y Nh√† Gi√°o Vi·ªát Nam 20/11 ‚Äî M·ªói l·ªùi ch√∫c g·ª≠i g·∫Øm y√™u th∆∞∆°ng.</p>

        <div class="card-area">
          <div class="letter" id="letter">
            <div class="envelope" id="envelope">
              <div class="env-front">
                <div class="peek">B·ª©c th∆∞ y√™u th∆∞∆°ng ‚Äî Nh·∫•n ƒë·ªÉ m·ªü</div>
                <div class="env-stamp">20/11</div>
              </div>
              <div class="env-inner" id="innerNote" style="display:none">
                <div style="font-weight:700;margin-bottom:6px">Ch·ªçn th·∫ßy/c√¥ nh·∫≠n thi·ªáp</div>
                <div style="display:flex;gap:8px;flex-wrap:wrap">
                  <!-- small preview photos created dynamically -->
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Teacher pages will be shown by hash navigation -->
  <div id="teachersContainer"></div>

  <footer>Trang web m·∫´u ‚Äî Thay ·∫£nh gi√°o vi√™n trong /img/teacher-{id}-{n}.jpg ho·∫∑c c·∫≠p nh·∫≠t url trong m√£.</footer>
</main>

<!-- background music (switch on/off) -->
<audio id="bgmusic" loop>
  <!-- user replace source.mp3 with actual file path -->
  <source src="/audio/background.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script>
// ----- Configuration: change teacher names and image paths here -----
const TEACHERS = [
  {id:'gv1', name:'Nguy·ªÖn Th·ªã A', title:'GV To√°n', cover:'/img/gv1_cover.jpg'},
  {id:'gv2', name:'Tr·∫ßn VƒÉn B', title:'GV VƒÉn', cover:'/img/gv2_cover.jpg'},
  {id:'gv3', name:'Ph·∫°m Th·ªã C', title:'GV L√Ω', cover:'/img/gv3_cover.jpg'},
  {id:'gv4', name:'L√™ VƒÉn D', title:'GV H√≥a', cover:'/img/gv4_cover.jpg'},
  {id:'gv5', name:'Ho√†ng Th·ªã E', title:'GV Sinh', cover:'/img/gv5_cover.jpg'},
  {id:'gv6', name:'ƒê·ªó VƒÉn F', title:'GV S·ª≠', cover:'/img/gv6_cover.jpg'},
  {id:'gv7', name:'V≈© Th·ªã G', title:'GV ƒê·ªãa', cover:'/img/gv7_cover.jpg'},
  {id:'gv8', name:'B√πi VƒÉn H', title:'GV Anh', cover:'/img/gv8_cover.jpg'}
];
// For each teacher, the gallery images are expected at /img/{id}-1.jpg ... -4.jpg

// ----- Heart draw animation -----
const stroke = document.getElementById('strokeHeart');
function animateHeart(){
  const len = stroke.getTotalLength();
  stroke.style.strokeDasharray = len;
  stroke.style.strokeDashoffset = len;
  stroke.getBoundingClientRect();
  // draw
  stroke.animate([{strokeDashoffset: len},{strokeDashoffset:0}],{duration:2200,fill:'forwards',easing:'ease-out'}).onfinish = ()=>{
    // after draw, reveal note peek
    document.getElementById('envelope').classList.add('open');
    // show inner note to pick teacher
    setTimeout(()=>{
      document.getElementById('innerNote').style.display='block';
      populateInnerNote();
    },400);
  }
}

// textPath slow scroll effect (keeps moving text around heart)
const tpath = document.querySelector('#tpath');
let offset = 0;
setInterval(()=>{offset = (offset + 0.2) % 100; tpath.setAttribute('startOffset', offset+'%');},60);

// ----- Envelope interactions -----
const envelope = document.getElementById('envelope');
envelope.addEventListener('mouseenter',()=>envelope.classList.add('hover'));
envelope.addEventListener('mouseleave',()=>envelope.classList.remove('hover'));
envelope.addEventListener('click',()=>{
  // open modal of teachers
  showTeachersModal();
});

// ----- Teachers modal -----
const modal = document.createElement('div'); modal.className='teachers-modal';
modal.innerHTML = `
  <div class="modal-card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <h3>Ch·ªçn Th·∫ßy/C√¥ nh·∫≠n thi·ªáp</h3>
      <div class="close-x" id="closeModal">‚úï</div>
    </div>
    <div class="teacher-grid" id="teacherGrid"></div>
  </div>`;
document.body.appendChild(modal);
modal.querySelector('#closeModal').addEventListener('click',()=>modal.classList.remove('show'));

function populateInnerNote(){
  const inner = document.getElementById('innerNote');
  const row = inner.querySelector('div');
  row.innerHTML = '';
  TEACHERS.forEach(t=>{
    const item = document.createElement('div'); item.style.width='64px'; item.style.margin='6px'; item.style.textAlign='center';
    const im = document.createElement('img'); im.src = t.cover; im.alt = t.name; im.style.width='64px'; im.style.height='64px'; im.style.borderRadius='6px'; im.style.objectFit='cover';
    const lb = document.createElement('div'); lb.textContent = t.name; lb.style.fontSize='11px'; lb.style.color='#222';
    item.appendChild(im); item.appendChild(lb);
    item.addEventListener('click',()=>{ navigateToTeacher(t.id); modal.classList.remove('show');});
    row.appendChild(item);
  });
}

function showTeachersModal(){
  const grid = modal.querySelector('#teacherGrid');
  grid.innerHTML='';
  TEACHERS.forEach(t=>{
    const item = document.createElement('div'); item.className='teacher-item';
    const img = document.createElement('img'); img.src=t.cover; img.alt=t.name; img.onerror = ()=>{img.style.background='#ddd'};
    const nm = document.createElement('div'); nm.textContent = t.name+' ‚Äî '+t.title; nm.style.fontWeight=600; nm.style.fontSize='13px'; nm.style.color='#111';
    item.appendChild(img); item.appendChild(nm);
    item.addEventListener('click',()=>{ modal.classList.remove('show'); navigateToTeacher(t.id); });
    grid.appendChild(item);
  });
  modal.classList.add('show');
}

// ----- Navigation and teacher pages generation -----
const container = document.getElementById('teachersContainer');
function buildTeacherPages(){
  TEACHERS.forEach(t => {
    const sec = document.createElement('section'); sec.className='teacher'; sec.id = t.id;
    sec.innerHTML = `
      <div class="teacher-header">
        <img src="${t.cover}" alt="${t.name}" onerror="this.style.background='#222'"/>
        <div>
          <h2 style="margin:0">${t.name}</h2>
          <div style="opacity:.9">${t.title}</div>
          <div style="margin-top:8px;color:rgba(255,255,255,0.75)">C√°c l·ªùi ch√∫c t·ª´ l·ªõp 9/4</div>
        </div>
      </div>
      <div class="teacher-body">
        <div>
          <div class="gallery" id="gallery-${t.id}"></div>
          <div style="margin-top:12px;color:rgba(255,255,255,0.7);font-size:13px">K√©o trang ƒë·ªÉ xem ·∫£nh - ·∫£nh s·∫Ω xu·∫•t hi·ªán khi t·ªõi ph·∫ßn t∆∞∆°ng ·ª©ng.</div>
        </div>
        <aside>
          <div class="messages" id="msgs-${t.id}"></div>
          <form class="form" id="form-${t.id}" onsubmit="return false;">
            <input placeholder="T√™n b·∫°n" id="name-${t.id}" required />
            <textarea placeholder="L·ªùi ch√∫c (t·ªëi ƒëa 300 k√Ω t·ª±)" id="text-${t.id}" maxlength="300" rows="4"></textarea>
            <button class="submit" data-id="${t.id}">G·ª≠i l·ªùi ch√∫c</button>
          </form>
        </aside>
      </div>`;
    container.appendChild(sec);

    // populate gallery
    const g = sec.querySelector('#gallery-'+t.id);
    for(let i=1;i<=4;i++){
      const im = document.createElement('img');
      im.dataset.src = `/img/${t.id}-${i}.jpg`;
      im.alt = `${t.name} ${i}`;
      g.appendChild(im);
    }
  });
}

// Save/load messages using localStorage
function loadMessages(id){
  const key = 'msgs_'+id; const raw = localStorage.getItem(key);
  try{ return raw?JSON.parse(raw):[]; }catch(e){return[]}
}
function saveMessages(id,arr){ localStorage.setItem('msgs_'+id, JSON.stringify(arr)); }
function renderMessages(id){
  const box = document.getElementById('msgs-'+id); if(!box) return;
  const arr = loadMessages(id);
  box.innerHTML = arr.reverse().map(m=>`<div class="msg"><b>${escapeHtml(m.name)}</b><div>${escapeHtml(m.text)}</div><div style="font-size:11px;opacity:.6;margin-top:6px">${new Date(m.t).toLocaleString()}</div></div>`).join('') || '<div style="opacity:.7">Ch∆∞a c√≥ l·ªùi ch√∫c n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</div>';
}

function escapeHtml(s){return String(s).replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));}

// attach form events
function attachFormHandlers(){
  TEACHERS.forEach(t=>{
    const form = document.getElementById('form-'+t.id);
    form.querySelector('.submit').addEventListener('click',()=>{
      const name = form.querySelector('#name-'+t.id).value.trim() || 'B·∫°n ·∫©n danh';
      const text = form.querySelector('#text-'+t.id).value.trim();
      if(!text){ alert('Vui l√≤ng vi·∫øt l·ªùi ch√∫c.'); return; }
      const arr = loadMessages(t.id);
      arr.push({name,text,t:Date.now()});
      saveMessages(t.id,arr);
      form.querySelector('#name-'+t.id).value=''; form.querySelector('#text-'+t.id).value='';
      renderMessages(t.id);
      // small celebratory firework
      launchSmallFirework();
    });
  });
}

// Lazy reveal gallery images on scroll
function setupGalleryObserver(){
  const imgs = document.querySelectorAll('.gallery img');
  const io = new IntersectionObserver(entries=>{
    entries.forEach(ent=>{
      if(ent.isIntersecting){
        const img = ent.target; img.src = img.dataset.src; img.classList.add('visible');
        io.unobserve(img);
      }
    });
  },{threshold:0.15});
  imgs.forEach(i=>io.observe(i));
}

// navigation
function navigateToTeacher(id){
  location.hash = id;
  setTimeout(()=>{
    const el = document.getElementById(id); if(el){window.scrollTo({top:el.offsetTop-70,behavior:'smooth'})}
  },80);
}

window.addEventListener('hashchange',()=>{
  const id = location.hash.replace('#',''); if(!id) return;
  const el = document.getElementById(id); if(el) window.scrollTo({top:el.offsetTop-70,behavior:'smooth'});
});

// ----- Fireworks (simple) -----
const canvas = document.getElementById('fw'); const ctx = canvas.getContext('2d'); let W=innerWidth,H=innerHeight; canvas.width=W;canvas.height=H; window.addEventListener('resize',()=>{W=innerWidth;H=innerHeight;canvas.width=W;canvas.height=H});
let particles = [];
function rand(a,b){return a + Math.random()*(b-a)}
function launch(x,y){
  const hue = Math.floor(rand(0,360));
  const count = 30 + Math.floor(Math.random()*40);
  for(let i=0;i<count;i++){particles.push({x,y,dx:Math.cos(i/count*Math.PI*2)*rand(1,6),dy:Math.sin(i/count*Math.PI*2)*rand(1,6),life:rand(700,1600),t:0,hue})}
}
function launchSmallFirework(){launch(rand(200, W-200), rand(120, H-200));}
function animateFW(ts){ctx.clearRect(0,0,W,H); for(let i=particles.length-1;i>=0;i--){const p=particles[i]; p.t+=16; p.x += p.dx; p.y += p.dy + 0.12*p.t/100; const alpha = 1 - p.t/p.life; if(alpha<=0){particles.splice(i,1);continue;} ctx.beginPath(); ctx.globalCompositeOperation='lighter'; ctx.fillStyle = `hsla(${p.hue},80%,60%,${alpha})`; ctx.arc(p.x,p.y,Math.max(1,3*alpha),0,Math.PI*2); ctx.fill(); } requestAnimationFrame(animateFW);} requestAnimationFrame(animateFW);

// click to create big firework
canvas.addEventListener('click',(e)=>{launch(e.clientX,e.clientY)});

// small automatic fireworks every so often on landing
setInterval(()=>{ if(location.hash) return; launch(rand(120,W-120), rand(120,H-200)) }, 3500);

// music control
const music = document.getElementById('bgmusic'); const musicToggle = document.getElementById('musicToggle');
musicToggle.addEventListener('click',()=>{
  if(music.paused){ music.play().catch(()=>{}); musicToggle.textContent='Nh·∫°c n·ªÅn ‚è∏'; } else { music.pause(); musicToggle.textContent='Nh·∫°c n·ªÅn ‚ñ∂'; }
});

// small fireworks helper called on send

// on load
buildTeacherPages(); attachFormHandlers(); setupGalleryObserver();
TEACHERS.forEach(t=>renderMessages(t.id));

// animate heart after small delay
setTimeout(animateHeart,800);

// expose modal open button
document.getElementById('openTeachers').addEventListener('click',showTeachersModal);

// helper to launch a bigger celebratory when form submitted (used above)
function launchCelebration(){ for(let i=0;i<6;i++){ setTimeout(()=>launch(rand(200,W-200), rand(120,H-200)), i*350); } }

// expose small launch
window.launchSmallFirework = launchSmallFirework;

</script>
</body>
</html>
    .petal.animate.delay1{animation-delay:0.15s}
    .petal.animate.delay2{animation-delay:0.28s}
    .petal.animate.delay3{animation-delay:0.4s}
    .petal.animate.delay4{animation-delay:0.52s}

    @keyframes bloom{
      0%{transform:scale(0.35) translateY(40px) rotate(0);opacity:0}
      60%{opacity:1}
      100%{transform:scale(1) translateY(0) rotate(0);opacity:1}
    }

    /* center core (small heart) */
    .core{width:120px;height:110px;border-radius:50% 50% 45% 45%;background:radial-gradient(circle at 35% 30%,#fff3f6 0,#ff9eb6 10%,#ff5c8a 60%);transform:rotate(45deg);filter:drop-shadow(0 8px 30px rgba(255,80,120,0.25));opacity:0;transform-origin:center;animation:corePop 0.9s 0.7s forwards}
    @keyframes corePop{0%{transform:scale(0.2) rotate(45deg);opacity:0}60%{opacity:1}100%{transform:scale(1) rotate(45deg);opacity:1}}

    /* intro text */
    .intro-text{margin-top:24px;font-size:28px;letter-spacing:1px;color:var(--accent);opacity:0;text-align:center}
    .intro-text.show{animation:fadeUp 0.9s 0.95s forwards}
    @keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

    /* sparkle/gold particles around heart */
    .spark-wrap{position:absolute;inset:0;z-index:9;pointer-events:none}

    /* ---------- ENVELOPE / LETTER ---------- */
    #letterStage{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:11;pointer-events:none}
    .envelope{width:320px;height:210px;background:linear-gradient(180deg,#fff,#ffeef3);border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,0.45);position:relative;transform-style:preserve-3d;cursor:pointer;pointer-events:auto}
    .env-flap{position:absolute;left:0;right:0;top:0;height:60%;background:linear-gradient(180deg,#ffdfe8,#fff);border-top-left-radius:12px;border-top-right-radius:12px;transform-origin:top center;transform:rotateX(0deg);transition:transform .8s cubic-bezier(.2,.9,.1,1);z-index:3}
    .env-body{position:absolute;left:8px;right:8px;bottom:8px;top:48px;background:#fff;border-radius:8px;padding:18px;overflow:hidden}
    .letter-inner{position:absolute;left:12px;right:12px;bottom:12px;height:0;background:linear-gradient(180deg,#fff,#fff);border-radius:8px;transform-origin:bottom center;transition:height .7s ease .3s}

    .envelope.open .env-flap{transform:rotateX(-140deg)}
    .envelope.open .letter-inner{height:86%}

    .open-hint{position:absolute;bottom:12px;left:0;right:0;text-align:center;color:#fff;opacity:.95;font-weight:600}

    /* teacher select modal */
    .modal{position:fixed;left:50%;top:80%;transform:translate(-50%,0);z-index:12;background:var(--card);padding:20px;border-radius:14px;backdrop-filter:blur(6px);display:flex;gap:12px;align-items:center;box-shadow:0 8px 40px rgba(0,0,0,0.5)}
    .modal select{padding:12px;border-radius:10px;border:none;font-size:16px}
    .modal button{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,#3bb6ff,#2a9df4);color:#04293A;font-weight:700;cursor:pointer}

    /* ---------- FILM / SLIDES ---------- */
    #film{position:absolute;inset:0;z-index:6;display:none;padding:20px;overflow:hidden}
    .film-track{display:flex;gap:28px;align-items:center;height:100%;transition:transform .9s cubic-bezier(.2,.9,.1,1)}
    .frame{min-width:88vw;height:76vh;border-radius:18px;background:#111;background-size:cover;background-position:center;flex-shrink:0;display:flex;align-items:flex-end;padding:24px;box-shadow:0 30px 80px rgba(0,0,0,0.6);backdrop-filter:blur(6px)}

    .frame .caption{background:linear-gradient(90deg, rgba(0,0,0,0.6), rgba(0,0,0,0.25));padding:14px;border-radius:12px}
    .frame .caption h3{margin:0 0 6px 0}
    .frame .caption p{margin:0;color:#ddd}

    .controls{position:absolute;left:50%;transform:translateX(-50%);bottom:30px;display:flex;gap:12px;z-index:20}
    .controls button{background:var(--glass);border:none;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}

    /* ---------- POLAROID GALLERY ---------- */
    .polaroid-container{position:absolute;right:20px;bottom:20px;z-index:7;pointer-events:none}
    .polaroid{width:110px;height:140px;background:#fff;padding:10px;border-radius:8px;box-shadow:0 14px 40px rgba(0,0,0,0.45);display:block;object-fit:cover;margin-bottom:12px;transform-origin:center;opacity:0}
    .falling{animation:fall 1.6s forwards cubic-bezier(.18,.9,.2,1)}
    .delay1{animation-delay:.3s}.delay2{animation-delay:.55s}.delay3{animation-delay:.75s}
    @keyframes fall{0%{opacity:0;transform:translateY(-40vh) rotate(-6deg) scale(.7)}60%{opacity:1}100%{transform:translateY(0) rotate(0) scale(1)}}

    /* bokeh glow on polaroid */
    .polaroid::after{content:"";position:absolute;inset:0;border-radius:8px;box-shadow:inset 0 0 60px rgba(255,200,220,0.04)}

    /* ---------- STUDENT WISHES PAGE ---------- */
    #wishes{position:absolute;inset:0;z-index:6;display:none;align-items:center;justify-content:center;padding:30px}
    .wish-card{max-width:880px;background:linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));padding:30px;border-radius:18px;backdrop-filter:blur(6px);box-shadow:0 30px 80px rgba(0,0,0,0.5);}
    .wish-card h2{margin-top:0}
    .wish-list{display:flex;flex-direction:column;gap:12px;margin-top:12px}
    .wish-item{background:rgba(255,255,255,0.03);padding:12px;border-radius:10px}

    /* responsive */
    @media (max-width:900px){
      .frame{min-width:92vw;height:68vh}
      .film-track{gap:16px}
      .polaroid-container{display:none}
      .modal{left:50%;top:auto;bottom:18px}
    }
  </style>
</head>
<body>

  <div class="stage">
    <canvas class="fireworks"></canvas>
    <div class="bokeh"></div>

    <!-- INTRO FLOWER-HEART -->
    <section id="intro">
      <div class="heart-wrap">
        <div class="petal p1"></div>
        <div class="petal p2"></div>
        <div class="petal p3"></div>
        <div class="petal p4"></div>
        <div class="petal p5"></div>
        <div class="core"></div>
      </div>
      <div class="intro-text" id="introText">Tri √¢n th·∫ßy c√¥ 20/11 ‚Äî L·ªõp 9/4</div>
      <div class="spark-wrap" id="sparkWrap"></div>
    </section>

    <!-- ENVELOPE -->
    <div id="letterStage">
      <div class="envelope" id="envelope" title="Nh·∫•n ƒë·ªÉ m·ªü th∆∞">
        <div class="env-flap"></div>
        <div class="env-body">
          <div class="letter-inner" id="letterInner">
            <div style="padding:18px;color:#333;"> <!-- inside letter content (hidden until open) -->
              <h3 style="margin:0 0 6px 0">L·ªùi tri √¢n l·ªõp 9/4</h3>
              <p style="margin:0;color:#444">K√≠nh ch√∫c th·∫ßy c√¥ 20/11 vui v·∫ª, m·∫°nh kh·ªèe v√† h·∫°nh ph√∫c. C·∫£m ∆°n v√¨ t·∫•t c·∫£!</p>
            </div>
          </div>
        </div>
      </div>
      <div class="open-hint">Nh·∫•n ƒë·ªÉ m·ªü th∆∞ g·ª≠i th·∫ßy c√¥ ‚ù§Ô∏è</div>
    </div>

    <!-- TEACHER CHOICE -->
    <div class="modal" id="teacherModal" style="display:none;pointer-events:auto">
      <label style="color:#cfe7ff;font-weight:700">Ch·ªçn th·∫ßy/c√¥:</label>
      <select id="teacherSelect">
        <option value="">-- Ch·ªçn --</option>
        <option value="CoA">C√¥ A</option>
        <option value="ThayB">Th·∫ßy B</option>
        <option value="CoC">C√¥ C</option>
      </select>
      <button id="startBtn">B·∫Øt ƒë·∫ßu</button>
    </div>

    <!-- FILM SLIDES -->
    <section id="film">
      <div class="film-track" id="filmTrack">
        <div class="frame" id="f1"><div class="caption"><h3 id="c1title"></h3><p id="c1text"></p></div></div>
        <div class="frame" id="f2"><div class="caption"><h3 id="c2title"></h3><p id="c2text"></p></div></div>
        <div class="frame" id="f3"><div class="caption"><h3 id="c3title"></h3><p id="c3text"></p></div></div>
      </div>
      <div class="controls">
        <button id="prev">Prev</button>
        <button id="next">Next</button>
        <button id="gotoWishes">L·ªùi ch√∫c</button>
      </div>
    </section>

    <!-- POLAROID GALLERY -->
    <div class="polaroid-container" id="polaroids">
      <img src="https://i.imgur.com/7m7J4pD.png" class="polaroid falling delay1" alt="p1">
      <img src="https://i.imgur.com/NpGwz9G.jpeg" class="polaroid falling delay2" alt="p2">
      <img src="https://i.imgur.com/z9wQ8QZ.jpeg" class="polaroid falling delay3" alt="p3">
    </div>

    <!-- STUDENT WISHES -->
    <section id="wishes">
      <div class="wish-card">
        <h2>üíå L·ªùi ch√∫c 20/11 t·ª´ H·ªçc sinh L·ªõp 9/4</h2>
        <div class="wish-list" id="wishList">
          <!-- items added dynamically -->
        </div>
      </div>
    </section>

    <!-- background music (provide music.mp3 in same folder) -->
    <audio id="bgm" src="music.mp3" loop></audio>

  </div>

  <script>
    // ---------- small helper ----------
    const $ = (sel)=>document.querySelector(sel);

    // ---------- INTRO SEQUENCE ----------
    const petals = document.querySelectorAll('.petal');
    const core = document.querySelector('.core');
    const introText = document.getElementById('introText');
    const sparkWrap = document.getElementById('sparkWrap');
    const envelope = document.getElementById('envelope');
    const teacherModal = document.getElementById('teacherModal');
    const startBtn = document.getElementById('startBtn');
    const bgm = document.getElementById('bgm');

    function playBgm(){
      // try to play (some browsers require user gesture) - will be triggered by click after open
      bgm.volume = 0.6;
      bgm.play().catch(()=>{});
    }

    // add bloom classes in order
    setTimeout(()=>{
      petals[0].classList.add('animate');
      petals[1].classList.add('animate','delay1');
      petals[2].classList.add('animate','delay2');
      petals[3].classList.add('animate','delay3');
      petals[4].classList.add('animate','delay4');
      core.classList.add('animate');
      introText.classList.add('show');

      // gentle particle sparkles
      createSparks(18);

      // after bloom show envelope
      setTimeout(()=>{
        document.getElementById('letterStage').style.pointerEvents='auto';
        document.querySelector('.open-hint').style.opacity=1;
      },1200);
    },350);

    function createSparks(n){
      for(let i=0;i<n;i++){
        const s=document.createElement('div');
        s.style.position='absolute';s.style.width='6px';s.style.height='6px';
        s.style.borderRadius='50%';s.style.left=(40+Math.random()*60)+'%';s.style.top=(30+Math.random()*40)+'%';
        s.style.background='radial-gradient(circle,#fff8, rgba(255,80,120,0.9) 40%, rgba(255,80,120,0.0) 60%)';
        s.style.opacity=0; s.style.transform='scale(.3)'; s.style.pointerEvents='none';
        sparkWrap.appendChild(s);
        setTimeout(()=>{s.style.transition='all 1.4s cubic-bezier(.2,.9,.1,1)';s.style.opacity=1;s.style.transform='scale(1) translateY(-20px)';},100+Math.random()*400);
        setTimeout(()=>{s.style.opacity=0; s.remove();},2200+Math.random()*1200);
      }
    }

    // ---------- ENVELOPE OPEN ----------
    envelope.addEventListener('click',()=>{
      envelope.classList.toggle('open');
      // show teacher choice modal
      teacherModal.style.display='flex';
      playBgm();
    });

    // ---------- TEACHER CHOICE / START ----------
    startBtn.addEventListener('click',()=>{
      const t = document.getElementById('teacherSelect').value;
      if(!t) return alert('Vui l√≤ng ch·ªçn th·∫ßy/c√¥');
      teacherModal.style.display='none';
      // begin film sequence
      startFilm(t);
    });

    // ---------- FILM SEQUENCE ----------
    const film = document.getElementById('film');
    const filmTrack = document.getElementById('filmTrack');
    let idx=0;
    const frames = [document.getElementById('f1'),document.getElementById('f2'),document.getElementById('f3')];

    const teacherData = {
      CoA:{slides:[
        {img:'https://i.imgur.com/87ikIDp.jpeg',title:'K·ª∑ ni·ªám c√πng C√¥ A',txt:'Nh·ªØng b√†i h·ªçc nh·∫π nh√†ng, t·∫≠n t√¢m.'},
        {img:'https://i.imgur.com/NpGwz9G.jpeg',title:'Nh·ªØng gi·ªù h·ªçc vui',txt:'C√¥ lu√¥n l·∫Øng nghe v√† chia s·∫ª.'},
        {img:'https://i.imgur.com/z9wQ8QZ.jpeg',title:'L·ªùi tri √¢n',txt:'C·∫£m ∆°n c√¥ ƒë√£ d√¨u d·∫Øt ch√∫ng em.'}
      ],wishTitle:'C√¥ A k√≠nh m·∫øn',wishText:'Ch√∫c c√¥ lu√¥n m·∫°nh kh·ªèe, h·∫°nh ph√∫c v√† t∆∞∆°i c∆∞·ªùi!'},
      ThayB:{slides:[
        {img:'https://i.imgur.com/oSgZxbN.jpeg',title:'Nh·ªØng kho·∫£nh kh·∫Øc c√πng Th·∫ßy B',txt:'S·ª± nghi√™m t√∫c nh∆∞ng ƒë·∫ßy ·∫•m √°p.'},
        {img:'https://i.imgur.com/7m7J4pD.png',title:'Gi·ªù ki·ªÉm tra',txt:'Th·∫ßy truy·ªÅn c·∫£m h·ª©ng cho ch√∫ng em.'},
        {img:'https://i.imgur.com/87ikIDp.jpeg',title:'L·ªùi tri √¢n',txt:'C·∫£m ∆°n th·∫ßy v√¨ t·∫•t c·∫£.'}
      ],wishTitle:'Th·∫ßy B k√≠nh m·∫øn',wishText:'Ch√∫c th·∫ßy lu√¥n m·∫°nh kh·ªèe, th√†nh c√¥ng v√† nhi·ªÅu ni·ªÅm vui!'},
      CoC:{slides:[
        {img:'https://i.imgur.com/z9wQ8QZ.jpeg',title:'K·ª∑ ni·ªám c√πng C√¥ C',txt:'N·ª• c∆∞·ªùi c·ªßa c√¥ l√† ƒë·ªông l·ª±c.'},
        {img:'https://i.imgur.com/NpGwz9G.jpeg',title:'Nh·ªØng gi·ªù ngo·∫°i kh√≥a',txt:'C√¥ lu√¥n ·ªü b√™n ch√∫ng em.'},
        {img:'https://i.imgur.com/oSgZxbN.jpeg',title:'L·ªùi tri √¢n',txt:'C·∫£m ∆°n c√¥ v√¨ nh·ªØng s·∫ª chia.'}
      ],wishTitle:'C√¥ C k√≠nh m·∫øn',wishText:'Ch√∫c c√¥ m·ªôt ng√†y 20/11 r·ª±c r·ª° v√† an l√†nh!'}
    };

    function startFilm(teacherKey){
      const data = teacherData[teacherKey];
      if(!data) return;
      // set frames
      frames.forEach((f,i)=>{
        f.style.backgroundImage = `url(${data.slides[i].img})`;
        f.querySelector('.caption h3').innerText = data.slides[i].title;
        f.querySelector('.caption p').innerText = data.slides[i].txt;
      });

      // show film
      film.style.display='block';
      // animate polaroids
      document.querySelectorAll('.polaroid').forEach((p,idx)=>{p.src = data.slides[idx%data.slides.length].img; p.classList.remove('falling'); void p.offsetWidth; p.classList.add('falling')});

      // autoplay slides every 4s
      idx=0; updateTrack();
      film.auto = setInterval(()=>{ idx = (idx+1)%frames.length; updateTrack();},4300);

      // prepare wishes content
      buildWishes(data.wishTitle,data.wishText);
    }

    function updateTrack(){ filmTrack.style.transform = `translateX(${ - (idx * (window.innerWidth * 0.02 + frames[0].offsetWidth)) }px)`; }

    // controls
    document.getElementById('next').addEventListener('click',()=>{ clearInterval(film.auto); idx=(idx+1)%frames.length; updateTrack(); film.auto=setInterval(()=>{ idx=(idx+1)%frames.length; updateTrack();},4300)});
    document.getElementById('prev').addEventListener('click',()=>{ clearInterval(film.auto); idx=(idx-1+frames.length)%frames.length; updateTrack(); film.auto=setInterval(()=>{ idx=(idx+1)%frames.length; updateTrack();},4300)});
    document.getElementById('gotoWishes').addEventListener('click',()=>{ clearInterval(film.auto); film.style.display='none'; showWishes(); });

    // ---------- WISHES ----------
    function buildWishes(title,text){
      const wishList = document.getElementById('wishList'); wishList.innerHTML='';
      const header = document.createElement('div'); header.className='wish-item'; header.style.fontWeight='700'; header.innerText = title + ' ‚Äî ' + text; wishList.appendChild(header);

      // sample student wishes - could be extended to accept input
      const samples = [
        'Ch√∫c th·∫ßy c√¥ lu√¥n m·∫°nh kh·ªèe, ƒë·∫ßy nhi·ªát huy·∫øt ƒë·ªÉ d·∫´n ƒë∆∞·ªùng ch√∫ng em.',
        'C·∫£m ∆°n th·∫ßy c√¥ ƒë√£ cho ch√∫ng em ki·∫øn th·ª©c v√† t√¨nh th∆∞∆°ng.',
        'Ch√∫c th·∫ßy c√¥ lu√¥n vui v·∫ª, h·∫°nh ph√∫c v√† lu√¥n nh·∫≠n ƒë∆∞·ª£c y√™u th∆∞∆°ng t·ª´ h·ªçc sinh.',
        'L·ªõp 9/4 m√£i nh·ªõ t·ªõi nh·ªØng k·ª∑ ni·ªám b√™n th·∫ßy c√¥!'
      ];
      samples.forEach(s=>{const el=document.createElement('div');el.className='wish-item';el.innerText='üíô '+s;wishList.appendChild(el)});
    }

    function showWishes(){
      document.getElementById('wishes').style.display='flex';
      window.scrollTo({top:0,behavior:'smooth'});
    }

    // ---------- FIREWORKS (simple particles) ----------
    const canvas = document.querySelector('canvas.fireworks');
    const ctx = canvas.getContext('2d');
    function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
    resize(); window.addEventListener('resize',resize);

    const sparks=[];
    function spawnFire(x,y){ for(let i=0;i<35;i++){ sparks.push({x,y, vx:(Math.random()-0.5)*6, vy:(Math.random()-1.5)*6, life: Math.random()*60+60, c: `hsl(${Math.random()*60+300},90%,60%)` }) } }

    function tick(){ ctx.clearRect(0,0,canvas.width,canvas.height); for(let i=sparks.length-1;i>=0;i--){ const p = sparks[i]; p.vy += 0.08; p.x += p.vx; p.y += p.vy; p.life--; ctx.globalCompositeOperation='lighter'; ctx.fillStyle = p.c; ctx.beginPath(); ctx.arc(p.x,p.y, Math.max(1,p.life/30),0,Math.PI*2); ctx.fill(); if(p.life<=0) sparks.splice(i,1); } requestAnimationFrame(tick); }
    tick();

    // occasional big fireworks during film
    setInterval(()=>{ if(document.getElementById('film').style.display==='block'){ spawnFire(Math.random()*innerWidth*0.8+innerWidth*0.1, innerHeight*0.35+Math.random()*innerHeight*0.2)} },1700);

    // ---------- ensure no errors if user interacts quickly ----------
    window.addEventListener('load',()=>{ try{ /* no-op */ }catch(e){console.error(e)} });

    // accessibility: allow pressing Enter to open envelope
    envelope.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' ') envelope.click(); });

  </script>
</body>
</html>

