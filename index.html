<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tri √¢n 20/11 - L·ªõp 9/4</title>
  <style>
    :root{
      --bg1:#06283D; /* deep blue */
      --bg2:#2A6F97; /* teal */
      --accent:#ffd6e0; /* soft pink */
      --glass: rgba(255,255,255,0.06);
      --card: rgba(255,255,255,0.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, Poppins, system-ui, Arial;background:linear-gradient(120deg,var(--bg1),var(--bg2));color:#fff}

    /* ---------- GLOBAL LAYERS ---------- */
    .stage{position:relative;width:100%;height:100vh;overflow:hidden}
    canvas.fireworks{position:absolute;inset:0;z-index:5;pointer-events:none}
    .bokeh{position:absolute;inset:0;z-index:2;pointer-events:none;background-image:radial-gradient(circle at 20% 30%, rgba(255,255,255,0.03) 0, transparent 20%),radial-gradient(circle at 80% 70%, rgba(255,255,255,0.02) 0, transparent 18%)}

    /* ---------- FLOWER-BLOOM HEART INTRO ---------- */
    #intro{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:10}
    .heart-wrap{position:relative;width:420px;height:280px;display:flex;align-items:center;justify-content:center}

    /* flower petals built with CSS shapes */
    .petal{position:absolute;width:160px;height:200px;background:linear-gradient(180deg,#ff92b6,#ff5c8a);border-radius:80% 80% 40% 40%;transform-origin:center bottom;filter:drop-shadow(0 10px 25px rgba(255,90,120,0.18));opacity:0}
    .petal.p1{transform:translate(-80px,-30px) rotate(-20deg) scale(0.6)}
    .petal.p2{transform:translate(80px,-30px) rotate(20deg) scale(0.6)}
    .petal.p3{transform:translate(0px,10px) rotate(0deg) scale(0.6)}
    .petal.p4{transform:translate(-40px,40px) rotate(-45deg) scale(0.55)}
    .petal.p5{transform:translate(40px,40px) rotate(45deg) scale(0.55)}

    /* bloom animations */
    .petal.animate{animation:bloom 1.2s forwards cubic-bezier(.2,.9,.1,1)}
    .petal.animate.delay1{animation-delay:0.15s}
    .petal.animate.delay2{animation-delay:0.28s}
    .petal.animate.delay3{animation-delay:0.4s}
    .petal.animate.delay4{animation-delay:0.52s}

    @keyframes bloom{
      0%{transform:scale(0.35) translateY(40px) rotate(0);opacity:0}
      60%{opacity:1}
      100%{transform:scale(1) translateY(0) rotate(0);opacity:1}
    }

    /* center core (small heart) */
    .core{width:120px;height:110px;border-radius:50% 50% 45% 45%;background:radial-gradient(circle at 35% 30%,#fff3f6 0,#ff9eb6 10%,#ff5c8a 60%);transform:rotate(45deg);filter:drop-shadow(0 8px 30px rgba(255,80,120,0.25));opacity:0;transform-origin:center;animation:corePop 0.9s 0.7s forwards}
    @keyframes corePop{0%{transform:scale(0.2) rotate(45deg);opacity:0}60%{opacity:1}100%{transform:scale(1) rotate(45deg);opacity:1}}

    /* intro text */
    .intro-text{margin-top:24px;font-size:28px;letter-spacing:1px;color:var(--accent);opacity:0;text-align:center}
    .intro-text.show{animation:fadeUp 0.9s 0.95s forwards}
    @keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}

    /* sparkle/gold particles around heart */
    .spark-wrap{position:absolute;inset:0;z-index:9;pointer-events:none}

    /* ---------- ENVELOPE / LETTER ---------- */
    #letterStage{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:11;pointer-events:none}
    .envelope{width:320px;height:210px;background:linear-gradient(180deg,#fff,#ffeef3);border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,0.45);position:relative;transform-style:preserve-3d;cursor:pointer;pointer-events:auto}
    .env-flap{position:absolute;left:0;right:0;top:0;height:60%;background:linear-gradient(180deg,#ffdfe8,#fff);border-top-left-radius:12px;border-top-right-radius:12px;transform-origin:top center;transform:rotateX(0deg);transition:transform .8s cubic-bezier(.2,.9,.1,1);z-index:3}
    .env-body{position:absolute;left:8px;right:8px;bottom:8px;top:48px;background:#fff;border-radius:8px;padding:18px;overflow:hidden}
    .letter-inner{position:absolute;left:12px;right:12px;bottom:12px;height:0;background:linear-gradient(180deg,#fff,#fff);border-radius:8px;transform-origin:bottom center;transition:height .7s ease .3s}

    .envelope.open .env-flap{transform:rotateX(-140deg)}
    .envelope.open .letter-inner{height:86%}

    .open-hint{position:absolute;bottom:12px;left:0;right:0;text-align:center;color:#fff;opacity:.95;font-weight:600}

    /* teacher select modal */
    .modal{position:fixed;left:50%;top:80%;transform:translate(-50%,0);z-index:12;background:var(--card);padding:20px;border-radius:14px;backdrop-filter:blur(6px);display:flex;gap:12px;align-items:center;box-shadow:0 8px 40px rgba(0,0,0,0.5)}
    .modal select{padding:12px;border-radius:10px;border:none;font-size:16px}
    .modal button{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,#3bb6ff,#2a9df4);color:#04293A;font-weight:700;cursor:pointer}

    /* ---------- FILM / SLIDES ---------- */
    #film{position:absolute;inset:0;z-index:6;display:none;padding:20px;overflow:hidden}
    .film-track{display:flex;gap:28px;align-items:center;height:100%;transition:transform .9s cubic-bezier(.2,.9,.1,1)}
    .frame{min-width:88vw;height:76vh;border-radius:18px;background:#111;background-size:cover;background-position:center;flex-shrink:0;display:flex;align-items:flex-end;padding:24px;box-shadow:0 30px 80px rgba(0,0,0,0.6);backdrop-filter:blur(6px)}

    .frame .caption{background:linear-gradient(90deg, rgba(0,0,0,0.6), rgba(0,0,0,0.25));padding:14px;border-radius:12px}
    .frame .caption h3{margin:0 0 6px 0}
    .frame .caption p{margin:0;color:#ddd}

    .controls{position:absolute;left:50%;transform:translateX(-50%);bottom:30px;display:flex;gap:12px;z-index:20}
    .controls button{background:var(--glass);border:none;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}

    /* ---------- POLAROID GALLERY ---------- */
    .polaroid-container{position:absolute;right:20px;bottom:20px;z-index:7;pointer-events:none}
    .polaroid{width:110px;height:140px;background:#fff;padding:10px;border-radius:8px;box-shadow:0 14px 40px rgba(0,0,0,0.45);display:block;object-fit:cover;margin-bottom:12px;transform-origin:center;opacity:0}
    .falling{animation:fall 1.6s forwards cubic-bezier(.18,.9,.2,1)}
    .delay1{animation-delay:.3s}.delay2{animation-delay:.55s}.delay3{animation-delay:.75s}
    @keyframes fall{0%{opacity:0;transform:translateY(-40vh) rotate(-6deg) scale(.7)}60%{opacity:1}100%{transform:translateY(0) rotate(0) scale(1)}}

    /* bokeh glow on polaroid */
    .polaroid::after{content:"";position:absolute;inset:0;border-radius:8px;box-shadow:inset 0 0 60px rgba(255,200,220,0.04)}

    /* ---------- STUDENT WISHES PAGE ---------- */
    #wishes{position:absolute;inset:0;z-index:6;display:none;align-items:center;justify-content:center;padding:30px}
    .wish-card{max-width:880px;background:linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));padding:30px;border-radius:18px;backdrop-filter:blur(6px);box-shadow:0 30px 80px rgba(0,0,0,0.5);}
    .wish-card h2{margin-top:0}
    .wish-list{display:flex;flex-direction:column;gap:12px;margin-top:12px}
    .wish-item{background:rgba(255,255,255,0.03);padding:12px;border-radius:10px}

    /* responsive */
    @media (max-width:900px){
      .frame{min-width:92vw;height:68vh}
      .film-track{gap:16px}
      .polaroid-container{display:none}
      .modal{left:50%;top:auto;bottom:18px}
    }
  </style>
</head>
<body>

  <div class="stage">
    <canvas class="fireworks"></canvas>
    <div class="bokeh"></div>

    <!-- INTRO FLOWER-HEART -->
    <section id="intro">
      <div class="heart-wrap">
        <div class="petal p1"></div>
        <div class="petal p2"></div>
        <div class="petal p3"></div>
        <div class="petal p4"></div>
        <div class="petal p5"></div>
        <div class="core"></div>
      </div>
      <div class="intro-text" id="introText">Tri √¢n th·∫ßy c√¥ 20/11 ‚Äî L·ªõp 9/4</div>
      <div class="spark-wrap" id="sparkWrap"></div>
    </section>

    <!-- ENVELOPE -->
    <div id="letterStage">
      <div class="envelope" id="envelope" title="Nh·∫•n ƒë·ªÉ m·ªü th∆∞">
        <div class="env-flap"></div>
        <div class="env-body">
          <div class="letter-inner" id="letterInner">
            <div style="padding:18px;color:#333;"> <!-- inside letter content (hidden until open) -->
              <h3 style="margin:0 0 6px 0">L·ªùi tri √¢n l·ªõp 9/4</h3>
              <p style="margin:0;color:#444">K√≠nh ch√∫c th·∫ßy c√¥ 20/11 vui v·∫ª, m·∫°nh kh·ªèe v√† h·∫°nh ph√∫c. C·∫£m ∆°n v√¨ t·∫•t c·∫£!</p>
            </div>
          </div>
        </div>
      </div>
      <div class="open-hint">Nh·∫•n ƒë·ªÉ m·ªü th∆∞ g·ª≠i th·∫ßy c√¥ ‚ù§Ô∏è</div>
    </div>

    <!-- TEACHER CHOICE -->
    <div class="modal" id="teacherModal" style="display:none;pointer-events:auto">
      <label style="color:#cfe7ff;font-weight:700">Ch·ªçn th·∫ßy/c√¥:</label>
      <select id="teacherSelect">
        <option value="">-- Ch·ªçn --</option>
        <option value="CoA">C√¥ A</option>
        <option value="ThayB">Th·∫ßy B</option>
        <option value="CoC">C√¥ C</option>
      </select>
      <button id="startBtn">B·∫Øt ƒë·∫ßu</button>
    </div>

    <!-- FILM SLIDES -->
    <section id="film">
      <div class="film-track" id="filmTrack">
        <div class="frame" id="f1"><div class="caption"><h3 id="c1title"></h3><p id="c1text"></p></div></div>
        <div class="frame" id="f2"><div class="caption"><h3 id="c2title"></h3><p id="c2text"></p></div></div>
        <div class="frame" id="f3"><div class="caption"><h3 id="c3title"></h3><p id="c3text"></p></div></div>
      </div>
      <div class="controls">
        <button id="prev">Prev</button>
        <button id="next">Next</button>
        <button id="gotoWishes">L·ªùi ch√∫c</button>
      </div>
    </section>

    <!-- POLAROID GALLERY -->
    <div class="polaroid-container" id="polaroids">
      <img src="https://i.imgur.com/7m7J4pD.png" class="polaroid falling delay1" alt="p1">
      <img src="https://i.imgur.com/NpGwz9G.jpeg" class="polaroid falling delay2" alt="p2">
      <img src="https://i.imgur.com/z9wQ8QZ.jpeg" class="polaroid falling delay3" alt="p3">
    </div>

    <!-- STUDENT WISHES -->
    <section id="wishes">
      <div class="wish-card">
        <h2>üíå L·ªùi ch√∫c 20/11 t·ª´ H·ªçc sinh L·ªõp 9/4</h2>
        <div class="wish-list" id="wishList">
          <!-- items added dynamically -->
        </div>
      </div>
    </section>

    <!-- background music (provide music.mp3 in same folder) -->
    <audio id="bgm" src="music.mp3" loop></audio>

  </div>

  <script>
    // ---------- small helper ----------
    const $ = (sel)=>document.querySelector(sel);

    // ---------- INTRO SEQUENCE ----------
    const petals = document.querySelectorAll('.petal');
    const core = document.querySelector('.core');
    const introText = document.getElementById('introText');
    const sparkWrap = document.getElementById('sparkWrap');
    const envelope = document.getElementById('envelope');
    const teacherModal = document.getElementById('teacherModal');
    const startBtn = document.getElementById('startBtn');
    const bgm = document.getElementById('bgm');

    function playBgm(){
      // try to play (some browsers require user gesture) - will be triggered by click after open
      bgm.volume = 0.6;
      bgm.play().catch(()=>{});
    }

    // add bloom classes in order
    setTimeout(()=>{
      petals[0].classList.add('animate');
      petals[1].classList.add('animate','delay1');
      petals[2].classList.add('animate','delay2');
      petals[3].classList.add('animate','delay3');
      petals[4].classList.add('animate','delay4');
      core.classList.add('animate');
      introText.classList.add('show');

      // gentle particle sparkles
      createSparks(18);

      // after bloom show envelope
      setTimeout(()=>{
        document.getElementById('letterStage').style.pointerEvents='auto';
        document.querySelector('.open-hint').style.opacity=1;
      },1200);
    },350);

    function createSparks(n){
      for(let i=0;i<n;i++){
        const s=document.createElement('div');
        s.style.position='absolute';s.style.width='6px';s.style.height='6px';
        s.style.borderRadius='50%';s.style.left=(40+Math.random()*60)+'%';s.style.top=(30+Math.random()*40)+'%';
        s.style.background='radial-gradient(circle,#fff8, rgba(255,80,120,0.9) 40%, rgba(255,80,120,0.0) 60%)';
        s.style.opacity=0; s.style.transform='scale(.3)'; s.style.pointerEvents='none';
        sparkWrap.appendChild(s);
        setTimeout(()=>{s.style.transition='all 1.4s cubic-bezier(.2,.9,.1,1)';s.style.opacity=1;s.style.transform='scale(1) translateY(-20px)';},100+Math.random()*400);
        setTimeout(()=>{s.style.opacity=0; s.remove();},2200+Math.random()*1200);
      }
    }

    // ---------- ENVELOPE OPEN ----------
    envelope.addEventListener('click',()=>{
      envelope.classList.toggle('open');
      // show teacher choice modal
      teacherModal.style.display='flex';
      playBgm();
    });

    // ---------- TEACHER CHOICE / START ----------
    startBtn.addEventListener('click',()=>{
      const t = document.getElementById('teacherSelect').value;
      if(!t) return alert('Vui l√≤ng ch·ªçn th·∫ßy/c√¥');
      teacherModal.style.display='none';
      // begin film sequence
      startFilm(t);
    });

    // ---------- FILM SEQUENCE ----------
    const film = document.getElementById('film');
    const filmTrack = document.getElementById('filmTrack');
    let idx=0;
    const frames = [document.getElementById('f1'),document.getElementById('f2'),document.getElementById('f3')];

    const teacherData = {
      CoA:{slides:[
        {img:'https://i.imgur.com/87ikIDp.jpeg',title:'K·ª∑ ni·ªám c√πng C√¥ A',txt:'Nh·ªØng b√†i h·ªçc nh·∫π nh√†ng, t·∫≠n t√¢m.'},
        {img:'https://i.imgur.com/NpGwz9G.jpeg',title:'Nh·ªØng gi·ªù h·ªçc vui',txt:'C√¥ lu√¥n l·∫Øng nghe v√† chia s·∫ª.'},
        {img:'https://i.imgur.com/z9wQ8QZ.jpeg',title:'L·ªùi tri √¢n',txt:'C·∫£m ∆°n c√¥ ƒë√£ d√¨u d·∫Øt ch√∫ng em.'}
      ],wishTitle:'C√¥ A k√≠nh m·∫øn',wishText:'Ch√∫c c√¥ lu√¥n m·∫°nh kh·ªèe, h·∫°nh ph√∫c v√† t∆∞∆°i c∆∞·ªùi!'},
      ThayB:{slides:[
        {img:'https://i.imgur.com/oSgZxbN.jpeg',title:'Nh·ªØng kho·∫£nh kh·∫Øc c√πng Th·∫ßy B',txt:'S·ª± nghi√™m t√∫c nh∆∞ng ƒë·∫ßy ·∫•m √°p.'},
        {img:'https://i.imgur.com/7m7J4pD.png',title:'Gi·ªù ki·ªÉm tra',txt:'Th·∫ßy truy·ªÅn c·∫£m h·ª©ng cho ch√∫ng em.'},
        {img:'https://i.imgur.com/87ikIDp.jpeg',title:'L·ªùi tri √¢n',txt:'C·∫£m ∆°n th·∫ßy v√¨ t·∫•t c·∫£.'}
      ],wishTitle:'Th·∫ßy B k√≠nh m·∫øn',wishText:'Ch√∫c th·∫ßy lu√¥n m·∫°nh kh·ªèe, th√†nh c√¥ng v√† nhi·ªÅu ni·ªÅm vui!'},
      CoC:{slides:[
        {img:'https://i.imgur.com/z9wQ8QZ.jpeg',title:'K·ª∑ ni·ªám c√πng C√¥ C',txt:'N·ª• c∆∞·ªùi c·ªßa c√¥ l√† ƒë·ªông l·ª±c.'},
        {img:'https://i.imgur.com/NpGwz9G.jpeg',title:'Nh·ªØng gi·ªù ngo·∫°i kh√≥a',txt:'C√¥ lu√¥n ·ªü b√™n ch√∫ng em.'},
        {img:'https://i.imgur.com/oSgZxbN.jpeg',title:'L·ªùi tri √¢n',txt:'C·∫£m ∆°n c√¥ v√¨ nh·ªØng s·∫ª chia.'}
      ],wishTitle:'C√¥ C k√≠nh m·∫øn',wishText:'Ch√∫c c√¥ m·ªôt ng√†y 20/11 r·ª±c r·ª° v√† an l√†nh!'}
    };

    function startFilm(teacherKey){
      const data = teacherData[teacherKey];
      if(!data) return;
      // set frames
      frames.forEach((f,i)=>{
        f.style.backgroundImage = `url(${data.slides[i].img})`;
        f.querySelector('.caption h3').innerText = data.slides[i].title;
        f.querySelector('.caption p').innerText = data.slides[i].txt;
      });

      // show film
      film.style.display='block';
      // animate polaroids
      document.querySelectorAll('.polaroid').forEach((p,idx)=>{p.src = data.slides[idx%data.slides.length].img; p.classList.remove('falling'); void p.offsetWidth; p.classList.add('falling')});

      // autoplay slides every 4s
      idx=0; updateTrack();
      film.auto = setInterval(()=>{ idx = (idx+1)%frames.length; updateTrack();},4300);

      // prepare wishes content
      buildWishes(data.wishTitle,data.wishText);
    }

    function updateTrack(){ filmTrack.style.transform = `translateX(${ - (idx * (window.innerWidth * 0.02 + frames[0].offsetWidth)) }px)`; }

    // controls
    document.getElementById('next').addEventListener('click',()=>{ clearInterval(film.auto); idx=(idx+1)%frames.length; updateTrack(); film.auto=setInterval(()=>{ idx=(idx+1)%frames.length; updateTrack();},4300)});
    document.getElementById('prev').addEventListener('click',()=>{ clearInterval(film.auto); idx=(idx-1+frames.length)%frames.length; updateTrack(); film.auto=setInterval(()=>{ idx=(idx+1)%frames.length; updateTrack();},4300)});
    document.getElementById('gotoWishes').addEventListener('click',()=>{ clearInterval(film.auto); film.style.display='none'; showWishes(); });

    // ---------- WISHES ----------
    function buildWishes(title,text){
      const wishList = document.getElementById('wishList'); wishList.innerHTML='';
      const header = document.createElement('div'); header.className='wish-item'; header.style.fontWeight='700'; header.innerText = title + ' ‚Äî ' + text; wishList.appendChild(header);

      // sample student wishes - could be extended to accept input
      const samples = [
        'Ch√∫c th·∫ßy c√¥ lu√¥n m·∫°nh kh·ªèe, ƒë·∫ßy nhi·ªát huy·∫øt ƒë·ªÉ d·∫´n ƒë∆∞·ªùng ch√∫ng em.',
        'C·∫£m ∆°n th·∫ßy c√¥ ƒë√£ cho ch√∫ng em ki·∫øn th·ª©c v√† t√¨nh th∆∞∆°ng.',
        'Ch√∫c th·∫ßy c√¥ lu√¥n vui v·∫ª, h·∫°nh ph√∫c v√† lu√¥n nh·∫≠n ƒë∆∞·ª£c y√™u th∆∞∆°ng t·ª´ h·ªçc sinh.',
        'L·ªõp 9/4 m√£i nh·ªõ t·ªõi nh·ªØng k·ª∑ ni·ªám b√™n th·∫ßy c√¥!'
      ];
      samples.forEach(s=>{const el=document.createElement('div');el.className='wish-item';el.innerText='üíô '+s;wishList.appendChild(el)});
    }

    function showWishes(){
      document.getElementById('wishes').style.display='flex';
      window.scrollTo({top:0,behavior:'smooth'});
    }

    // ---------- FIREWORKS (simple particles) ----------
    const canvas = document.querySelector('canvas.fireworks');
    const ctx = canvas.getContext('2d');
    function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
    resize(); window.addEventListener('resize',resize);

    const sparks=[];
    function spawnFire(x,y){ for(let i=0;i<35;i++){ sparks.push({x,y, vx:(Math.random()-0.5)*6, vy:(Math.random()-1.5)*6, life: Math.random()*60+60, c: `hsl(${Math.random()*60+300},90%,60%)` }) } }

    function tick(){ ctx.clearRect(0,0,canvas.width,canvas.height); for(let i=sparks.length-1;i>=0;i--){ const p = sparks[i]; p.vy += 0.08; p.x += p.vx; p.y += p.vy; p.life--; ctx.globalCompositeOperation='lighter'; ctx.fillStyle = p.c; ctx.beginPath(); ctx.arc(p.x,p.y, Math.max(1,p.life/30),0,Math.PI*2); ctx.fill(); if(p.life<=0) sparks.splice(i,1); } requestAnimationFrame(tick); }
    tick();

    // occasional big fireworks during film
    setInterval(()=>{ if(document.getElementById('film').style.display==='block'){ spawnFire(Math.random()*innerWidth*0.8+innerWidth*0.1, innerHeight*0.35+Math.random()*innerHeight*0.2)} },1700);

    // ---------- ensure no errors if user interacts quickly ----------
    window.addEventListener('load',()=>{ try{ /* no-op */ }catch(e){console.error(e)} });

    // accessibility: allow pressing Enter to open envelope
    envelope.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' ') envelope.click(); });

  </script>
</body>
</html>
