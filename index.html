<!doctype html>
<html lang="vi">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tri √¢n 20/11 ‚Äî L·ªõp 9/4</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Pacifico&display=swap"
    rel="stylesheet">
  <!-- Firebase App (core) SDK -->
  <script type="module">

  </script>

  <style>
    :root {
      --bg1: #1b1b2f;
      --bg2: #2b2a4a;
      --card: #fff;
      --accent: #ff7a7a;
      --glass: rgba(255, 255, 255, 0.06);
      --card-radius: 16px;
    }

    html,
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #FDE6EC, #F7DCE5, #FADDEB);
      background-size: 400% 400%;
      animation: pastelMove 18s ease infinite;
      margin: 0;
      padding: 0;
    }

    @keyframes pastelMove {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    /* Container */
    .wrap {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      gap: 20px;
      position: relative;
    }

    /* Intro panel */
    .intro {
      width: 100%;
      max-width: 980px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
      backdrop-filter: blur(6px);
      border-radius: 20px;
      padding: 36px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
      position: relative;
      overflow: hidden;
    }

    .heart-wrap {
      display: flex;
      align-items: center;
      gap: 24px;
      flex-wrap: wrap;
    }

    .left {
      flex: 1;
      min-width: 260px;
    }

    .right {
      flex: 1;
      min-width: 260px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    svg#heart {
      width: 320px;
      height: 320px;
      display: block
    }

    .handwriting {
      font-family: 'Pacifico', cursive;
      font-size: 20px;
      color: var(--card);
      opacity: 0;
      white-space: nowrap;
    }

    .envelope {
      width: 240px;
      height: 150px;
      background: linear-gradient(180deg, #fff3, #ffe9);
      border-radius: 12px;
      position: relative;
      transform-origin: center;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      transition: transform .45s cubic-bezier(.2, .9, .3, 1);
    }

    .envelope:hover {
      transform: translateY(-6px) scale(1.02)
    }

    .card-tab {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -60%);
      width: 86%;
      height: 68%;
      background: linear-gradient(180deg, #fff, #fff8);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #222
    }

    /* tile grid of teachers hidden until envelope clicked */
    .tiles {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 14px;
      margin-top: 22px
    }

    .tile {
      background: var(--glass);
      padding: 12px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: transform .22s;
      backdrop-filter: blur(6px)
    }

    .tile:hover {
      transform: translateY(-6px)
    }

    .tile img {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid rgba(255, 255, 255, 0.06)
    }

    .tile h4 {
      margin: 8px 0 0 0;
      font-size: 14px
    }

    .tile p {
      margin: 4px 0 0 0;
      font-size: 12px;
      color: rgb(77, 77, 64)
    }

    /* Modal / teacher view */
    .teacher-view {
      position: fixed;
      inset: 0;
      background: linear-gradient(180deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.85));
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 50
    }

    .teacher-card {
      width: 100%;
      max-width: 980px;
      background: var(--card);
      color: #222;
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
      overflow: auto;
      max-height: 92vh
    }

    .tv-header {
      display: flex;
      gap: 14px;
      align-items: center
    }

    .tv-header img {
      width: 96px;
      height: 96px;
      border-radius: 12px;
      object-fit: cover
    }

    .tv-header h2 {
      margin: 0
    }

    .gallery {
      display: flex;
      gap: 10px;
      margin-top: 12px
    }

    .gallery img {
      width: 100%;
      max-height: 260px;
      object-fit: cover;
      border-radius: 12px;
      flex: 1;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity .6s, transform .6s
    }

    .wish-list {
      margin-top: 14px
    }

    .wish {
      background: #fff3;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 8px;
      color: #222
    }

    .wish small {
      display: block;
      color: #666
    }

    .wish-form {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px
    }

    .wish-form input,
    .wish-form textarea {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #eee;
      font-size: 14px
    }

    .btn {
      background: var(--accent);
      color: #fff;
      padding: 10px 12px;
      border-radius: 10px;
      border: 0;
      cursor: pointer;
      font-weight: 600
    }

    /* audio toggle & fireworks btn */
    .controls {
      position: fixed;
      right: 18px;
      bottom: 18px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 60
    }

    .control-btn {
      background: rgba(255, 255, 255, 0.06);
      padding: 10px;
      border-radius: 12px;
      color: #fff;
      backdrop-filter: blur(6px);
      border: 0;
      cursor: pointer
    }

    /* small responsive tweaks */
    @media (max-width:720px) {
      .heart-wrap {
        flex-direction: column
      }

      .intro {
        padding: 18px
      }

      .gallery {
        flex-direction: column
      }
    }

    /* typing effect for wishes */
    .typing {
      border-right: 2px solid rgba(0, 0, 0, 0.6);
      display: inline-block;
      padding-right: 6px;
      animation: blink .9s steps(2) infinite
    }

    @keyframes blink {
      50% {
        border-color: transparent
      }
    }

    /* fireworks canvas sits behind teacher card when active */
    canvas#fireworks {
      position: fixed;
      left: 0;
      top: 0;
      pointer-events: none;
      z-index: 40;
      display: none
    }

    /* small accessibility focus */
    .tile:focus {
      outline: 2px dashed rgba(255, 255, 255, 0.2)
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="intro" aria-live="polite">
      <div class="heart-wrap">
        <div class="left">
          <svg id="heart" viewBox="0 0 512 512" role="img" aria-label="Tr√°i tim tri √¢n">
            <defs>
              <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0" stop-color="#ff7a7a" />
                <stop offset="1" stop-color="#ffd070" />
              </linearGradient>
            </defs>
            <path id="heartPath"
              d="M256 448s-160-96-200-176C20 176 96 80 192 112 224 120 256 144 256 144s32-24 64-32c96-32 172 64 136 160-40 80-200 176-200 176z"
              fill="none" stroke="url(#g1)" stroke-width="10" stroke-linecap="round" stroke-linejoin="round" />
            <path
              d="M256 448s-160-96-200-176C20 176 96 80 192 112 224 120 256 144 256 144s32-24 64-32c96-32 172 64 136 160-40 80-200 176-200 176z"
              fill="rgba(255,255,255,0.03)" />
          </svg>
          <div style="margin-top:10px">
            <div class="handwriting" id="handwriting">Ch√∫c m·ª´ng Ng√†y Nh√† Gi√°o Vi·ªát Nam 20/11 ‚Äî L·ªõp 9/4</div>
            <p style="opacity:0.9;margin-top:8px;color:rgb(51, 51, 42)">M·ªôt m√≥n qu√† nh·ªè g·ª≠i ƒë·∫øn c√°c th·∫ßy c√¥ ‚Äî click v√†o
              phong th∆∞
              ƒë·ªÉ ch·ªçn t√™n th·∫ßy/c√¥.</p>
          </div>
        </div>
        <div class="right">
          <div class="envelope" id="envelope" tabindex="0" role="button" aria-label="M·ªü phong th∆∞">
            <div class="card-tab">Thi·ªáp b·∫•t ng·ªù</div>
          </div>
        </div>
      </div>

      <!-- tiles (hidden initially) -->
      <div id="tilesWrapper" style="display:none;margin-top:18px">
        <h3 style="margin:6px 0 10px 0">Th·∫ßy c√¥ l√† ai ·∫°?</h3>
        <div class="tiles" id="tiles"></div>
      </div>
    </div>
  </div>

  <!-- teacher modal -->
  <div class="teacher-view" id="teacherView" aria-hidden="true">
    <div class="teacher-card" role="dialog" aria-modal="true" aria-labelledby="teacherTitle">
      <button id="closeTeacher" style="float:right;border:0;background:none;font-weight:700;cursor:pointer">‚úï</button>
      <div class="tv-header">
        <img id="teacherAvatar" src="" alt="">
        <div>
          <h2 id="teacherTitle"></h2>
          <p id="teacherSubject" style="margin:6px 0 0 0;color:#666"></p>
          <div style="margin-top:6px">
            <button class="btn" id="fireworkBtn">Ph√°o hoa!</button>
          </div>
        </div>
      </div>

      <div class="gallery" id="gallery">
        <!-- images -->
      </div>

      <div class="wish-list" id="wishList">
        <h3 style="margin-top:12px">L·ªùi ch√∫c c·ªßa h·ªçc sinh</h3>
        <div id="wishesContainer"></div>
      </div>

      <div class="wish-form"> <input id="inputName" placeholder="T√™n (ho·∫∑c ƒë·ªÉ tr·ªëng ƒë·ªÉ ·∫©n t√™n)"> <input id="inputClass"
          placeholder="L·ªõp, v√≠ d·ª•: 9/4"> <textarea id="inputContent" rows="4" placeholder="Vi·∫øt l·ªùi ch√∫c..."
          maxlength="800"></textarea> <label><input type="checkbox" id="hideName"> ·∫®n t√™n</label>
        <button class="btn" id="sendWish">G·ª≠i l·ªùi ch√∫c</button>
      </div>
    </div>
  </div>
  </div>
  </div>

  <!-- fireworks canvas -->
  <canvas id="fireworks"></canvas>

  <!-- controls -->
  <div class="controls" aria-hidden="false">
    <button class="control-btn" id="openAll">üè† V·ªÅ trang ch√≠nh</button>
    
  </div>

<audio id="bgAudio" loop>
  <source src="assets/bg-music.mp3" type="audio/mpeg">
</audio>
  <a href="admin.html">üè†</a>


  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";

    // Firestore
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp,
      query,
      where,
      orderBy,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCBOxu2m8gBVudjy8tUUPIji7COaMFUKMM",
      authDomain: "web20thang11.firebaseapp.com",
      projectId: "web20thang11",
      storageBucket: "web20thang11.firebasestorage.app",
      messagingSenderId: "876267619684",
      appId: "1:876267619684:web:2238ef31aacf8a7e966671",
      measurementId: "G-8J68YJC7F1"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    const db = getFirestore(app);

    // expose for your script
    window._db = db;
    window._fs = { collection, addDoc, serverTimestamp, query, where, orderBy, onSnapshot };
    window.escapeHtml = function (str) {
      if (!str) return '';
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    };

    /*****************************
     * CONFIG
     *****************************/
    // N·∫øu b·∫°n mu·ªën l∆∞u th·ª±c t·∫ø: ƒë·∫∑t endpoint Google Apps Script (web app ch·∫°y doPost)
    const SHEET_ENDPOINT = ''; // v√≠ d·ª•: 'https://script.google.com/macros/s/AKfycbx.../exec'
    // C√°c teacher m·∫´u ‚Äî thay ·∫£nh b·∫±ng URL th·ª±c t·∫ø
    const TEACHERS = [
      { id: 'gv1', name: 'C√¥ Hu·ª≥nh Th·ªã Ph∆∞∆°ng Ng·ªçc', subject: 'Gi√°o vi√™n ch·ªß nhi·ªám', avatar: 'assets/GV1.png', photos: ['assets/GV1_1.jpg', 'assets/GV1_2.jpg'] },
      { id: 'gv2', name: 'C√¥ Tr·∫ßn Th·ªã Kim Y·∫øn', subject: 'To√°n', avatar: 'assets/GV2.jpg', photos: ['assets/GV2.jpg'] },
      { id: 'gv3', name: 'C√¥ L√™ Minh Hoa', subject: 'Ng·ªØ VƒÉn', avatar: 'assets/GV3.png', photos: ['assets/GV3.png'] },
      { id: 'gv4', name: 'C√¥ Tr·∫ßn Ng·ªçc Minh', subject: 'Ti·∫øng Anh', avatar: 'assets/GV4.jpg', photos: ['assets/GV4.jpg'] },
      { id: 'gv5', name: 'Th·∫ßy Ph·∫°m Ki√™n Th√†nh', subject: 'Ti·∫øng Anh', avatar: 'assets/GV5.jpg', photos: ['assets/GV5_1.jpg', 'assets/GV5_2.jpg', 'assets/GV5_3.jpg'] },
      { id: 'gv6', name: 'Th·∫ßy Nguy·ªÖn Huy Hi·ªáp', subject: 'Khoa H·ªçc T·ª± Nhi√™n', avatar: 'assets/GV6.jpg', photos: ['assets/GV6_1.jpg'] },
      { id: 'gv7', name: 'C√¥ Nguy·ªÖn Th·ªã Thanh Loan', subject: 'GDCD', avatar: 'assets/GV7.jpg', photos: ['assets/GV7_1.jpg', 'assets/GV7_2.jpg'] },
      { id: 'gv8', name: 'C√¥ Nguy·ªÖn Tri Th·ªã T√¢m', subject: 'Tin H·ªçc', avatar: 'assets/GV8.jpg', photos: ['assets/GV8_1.jpg', 'assets/GV8_2.jpg', 'assets/GV8_3.jpg'] },
      { id: 'gv9', name: 'Th·∫ßy Nguy·ªÖn ƒêi·ªÅn Kh·∫Øc Duy', subject: 'L·ªãch S·ª≠ - ƒê·ªãa L√Ω', avatar: 'assets/GV9.png', photos: ['assets/GV9_1.png'] },
      { id: 'gv10', name: 'C√¥ L√™ Th·ªã H·∫£i H∆∞ng', subject: 'Ngh·ªá Thu·∫≠t', avatar: 'assets/GV10.jpg', photos: [] },
      { id: 'gv11', name: 'Th·∫ßy Tr·∫ßn Vi·ªát Tu·∫•n', subject: 'Gi√°o D·ª•c Th·ªÉ Ch·∫•t', avatar: 'assets/GV11.jpg', photos: [] },
    ];

    // demo storage keys (for demo without backend)
    const STORAGE_KEY = 'wishes_demo_9_4';

    /*****************************
     * UTILS: small helpers
     *****************************/
    function $(sel) { return document.querySelector(sel) }
    function $all(sel) { return Array.from(document.querySelectorAll(sel)) }
    function saveLocal(wishes) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(wishes || []));
    }
    function loadLocal() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]') } catch (e) { return [] }
    }

    /*****************************
     * Heart stroke animation + typing reveal
     *****************************/
    (function heartAnim() {
      const path = document.getElementById('heartPath');
      const length = path.getTotalLength();
      path.style.strokeDasharray = length;
      path.style.strokeDashoffset = length;
      path.getBoundingClientRect(); // force layout
      path.style.transition = 'stroke-dashoffset 2.4s ease-in-out';
      setTimeout(() => { path.style.strokeDashoffset = '0'; }, 600);

      // handwriting fade-in after draw
      setTimeout(() => { const hw = document.getElementById('handwriting'); hw.style.opacity = 1; hw.classList.add('typing') }, 3100);
    })();

    /*****************************
     * Envelope -> show tiles
     *****************************/
    const envelope = document.getElementById('envelope');
    const tilesWrapper = document.getElementById('tilesWrapper');
    const tilesEl = document.getElementById('tiles');
    let envelopeOpened = false;
    function renderTiles() {
      tilesEl.innerHTML = '';
      TEACHERS.forEach(t => {
        const div = document.createElement('button');
        div.className = 'tile';
        div.setAttribute('data-id', t.id);
        div.innerHTML = `<img loading="lazy" src="${t.avatar}" alt="${t.name}"/><h4>${t.name}</h4><p>${t.subject}</p>`;
        div.addEventListener('click', () => openTeacher(t.id));
        tilesEl.appendChild(div);
      });
    }
    envelope.addEventListener('click', openEnvelope);
    envelope.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') openEnvelope() })
    function openEnvelope() {
      if (envelopeOpened) return;
      envelopeOpened = true;
      // simple 3D open effect
      envelope.style.transition = 'transform .6s cubic-bezier(.2,.9,.3,1)';
      envelope.style.transform = 'rotateX(12deg) translateY(-18px) scale(1.02)';
      // show tiles after animation
      setTimeout(() => { tilesWrapper.style.display = 'block'; renderTiles(); }, 620);
      // optionally play sound (omitted asset): simulate with small web audio or leave for implementer
    }

    /*****************************
     * Routing: open teacher by hash or id
     *****************************/
    const teacherView = document.getElementById('teacherView');
    const teacherAvatar = document.getElementById('teacherAvatar');
    const teacherTitle = document.getElementById('teacherTitle');
    const teacherSubject = document.getElementById('teacherSubject');
    const gallery = document.getElementById('gallery');
    const wishesContainer = document.getElementById('wishesContainer');

    function getTeacherById(id) {
      return TEACHERS.find(t => t.id === id);
    }

    function openTeacher(id) {
      const t = getTeacherById(id);
      if (!t) return;
      // render header
      teacherAvatar.src = t.avatar;
      teacherAvatar.alt = t.name;
      teacherTitle.textContent = t.name;
      teacherSubject.textContent = t.subject;
      // gallery
      gallery.innerHTML = '';
      const photos = (t.photos && t.photos.length) ? t.photos : [t.avatar];
      photos.forEach(p => {
        const img = document.createElement('img');
        img.dataset.src = p;
        img.alt = t.name + ' photo';
        gallery.appendChild(img);
      });
      // show wishes for this teacher
      renderWishesForTeacherRealtime(id);
      // show modal
      teacherView.style.display = 'flex';
      teacherView.setAttribute('aria-hidden', 'false');
      // set hash for linkability
      location.hash = `teacher=${id}`;
      // lazy reveal images via IntersectionObserver
      setTimeout(initLazyReveal, 100);
    }

    $('#closeTeacher').addEventListener('click', closeTeacher);
    function closeTeacher() {
      teacherView.style.display = 'none';
      teacherView.setAttribute('aria-hidden', 'true');
      // remove hash
      history.pushState("", document.title, window.location.pathname + window.location.search);
      stopFireworks();
    }

    // open via hash on load
    window.addEventListener('load', () => {
      const hash = location.hash.replace('#', '');
      if (hash.startsWith('teacher=')) {
        const id = hash.split('=')[1];
        // simulate envelope open first
        openEnvelope();
        setTimeout(() => openTeacher(id), 700);
      }
    });

    /*****************************
     * Lazy load + fade-in (IntersectionObserver)
     *****************************/
    let io;
    function initLazyReveal() {
      if (io) io.disconnect();
      const imgs = gallery.querySelectorAll('img');
      const options = { root: null, rootMargin: '100px', threshold: 0.1 };
      io = new IntersectionObserver((entries, obs) => {
        entries.forEach(en => {
          if (en.isIntersecting) {
            const img = en.target;
            img.src = img.dataset.src;
            img.onload = () => { img.style.opacity = 1; img.style.transform = 'translateY(0)'; }
            obs.unobserve(img);
          }
        });
      }, options);
      imgs.forEach(i => io.observe(i));
    }

    /*****************************
     * Wishes: local storage + POST to sheet (if configured)
     *****************************/
    async function renderWishesForTeacherRealtime(teacherId) {
      const {
        collection,
        query,
        where,
        orderBy,
        onSnapshot
      } = window._fs;
      const db = window._db;

      wishesContainer.innerHTML = "<p style='color:#aaa'>ƒêang t·∫£i...</p>";

      const q = query(
        collection(db, "wishes"),
        where("teacherId", "==", teacherId),
        where("status", "==", "approved"),
        orderBy("ts", "desc")
      );

      // L·∫ÆNG NGHE REALTIME
      onSnapshot(q, (snap) => {
        wishesContainer.innerHTML = "";

        if (snap.empty) {
          wishesContainer.innerHTML = "<p style='color:#999'>Ch∆∞a c√≥ l·ªùi ch√∫c n√†o.</p>";
          return;
        }

        snap.forEach((doc) => {
          const w = doc.data();

          // chuy·ªÉn timestamp sang Date
          const d = w.ts?.toDate ? w.ts.toDate() : new Date(w.ts);

          const el = document.createElement("div");
          el.className = "wish";
          el.innerHTML = `
    <strong>${w.hidden ? "·∫®n t√™n" : (w.name || "H·ªçc sinh")}</strong>
    <small>${d.toLocaleString()}</small>
    <div style="margin-top:6px">${escapeHtml(w.content)}</div>
  `;
          wishesContainer.appendChild(el);
        });

      });
    }



    // ---- g·ª≠i l·ªùi ch√∫c ----
    document.getElementById('sendWish').addEventListener('click', async () => {
      const name = document.getElementById('inputName').value.trim();
      const klass = document.getElementById('inputClass').value.trim();
      const content = document.getElementById('inputContent').value.trim();
      const hidden = document.getElementById('hideName').checked;
      const teacherId = location.hash.replace('#', '').split('=')[1] || null;
      if (!teacherId) { alert('L·ªói: kh√¥ng x√°c ƒë·ªãnh th·∫ßy/c√¥'); return; }
      if (content.length < 4) { alert('L·ªùi ch√∫c qu√° ng·∫Øn'); return; }

      const wish = {
        teacherId,
        name: name || '',
        klass: klass || '',
        content,
        hidden,
        ts: window._fs.serverTimestamp(), // gi·ªù ch·∫Øc ch·∫Øn t·ªìn t·∫°i
        status: "pending",
      };

      try {
        await window._fs.addDoc(window._fs.collection(window._db, "wishes"), wish);
        alert('ƒê√£ g·ª≠i l·ªùi ch√∫c, ch·ªù admin duy·ªát.');
        document.getElementById('inputContent').value = '';
      } catch (e) {
        console.error(e);
        alert('G·ª≠i l·ªùi ch√∫c th·∫•t b·∫°i, th·ª≠ l·∫°i sau.');
      }
    });


    /*****************************
     * Audio background toggle
     *****************************/
    const audioToggle = document.getElementById('audioToggle');
    const bgAudio = document.getElementById('bgAudio');
    
    // C·∫≠p nh·∫≠t icon theo tr·∫°ng th√°i
    function updateAudioBtn() {
      audioToggle.textContent = bgAudio.paused ? 'üîä B·∫≠t nh·∫°c n·ªÅn' : 'üîá T·∫Øt nh·∫°c n·ªÅn';
    }
    
    audioToggle.addEventListener('click', async () => {
      try {
        if (bgAudio.paused) {
          // Ch·ªâ play khi ch∆∞a ph√°t
          await bgAudio.play();
        } else {
          bgAudio.pause();
        }
        updateAudioBtn();
      } catch (e) {
        console.log('Play b·ªã ng·∫Øt:', e);
      }
    });
    
    // Kh·ªüi t·∫°o icon ƒë√∫ng tr·∫°ng th√°i l√∫c load
    updateAudioBtn();


    /*****************************
     * Fireworks canvas (simple)
     *****************************/
    const fireCanvas = document.getElementById('fireworks');
    const ctx = fireCanvas.getContext('2d');
    let fwAnim = null;
    function resizeCanvas() { fireCanvas.width = window.innerWidth; fireCanvas.height = window.innerHeight; }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function startFireworks(color = '#ff7a7a') {
      fireCanvas.style.display = 'block';
      const particles = [];
      function spawn(x, y) {
        for (let i = 0; i < 80; i++) {
          particles.push({
            x, y,
            vx: (Math.random() - 0.5) * 6,
            vy: (Math.random() - 1.5) * 6,
            life: Math.random() * 60 + 40,
            r: Math.random() * 2 + 1,
            col: color
          });
        }
      }
      // spawn center
      spawn(window.innerWidth / 2, window.innerHeight / 3);

      function loop() {
        ctx.clearRect(0, 0, fireCanvas.width, fireCanvas.height);
        for (let i = particles.length - 1; i >= 0; i--) {
          const p = particles[i];
          p.x += p.vx; p.y += p.vy; p.vy += 0.06; p.life--;
          ctx.beginPath(); ctx.globalAlpha = Math.max(0, p.life / 120); ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2); ctx.fillStyle = p.col; ctx.fill();
          if (p.life <= 0) particles.splice(i, 1);
        }
        if (particles.length < 10) spawn(Math.random() * fireCanvas.width, Math.random() * fireCanvas.height / 3);
        fwAnim = requestAnimationFrame(loop);
      }
      loop();
      // auto stop after 7s
      setTimeout(stopFireworks, 7000);
    }
    function stopFireworks() {
      if (fwAnim) cancelAnimationFrame(fwAnim);
      ctx.clearRect(0, 0, fireCanvas.width, fireCanvas.height);
      fireCanvas.style.display = 'none';
    }

    document.getElementById('fireworkBtn').addEventListener('click', () => startFireworks('#ffd070'));

    /*****************************
     * Open all / home btn & keyboard
     *****************************/
    document.getElementById('openAll').addEventListener('click', () => { closeTeacher(); window.scrollTo({ top: 0, behavior: 'smooth' }) });

    // Escape closes teacher view
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeTeacher(); });

    /*****************************
     * Init: render tiles hidden at start
     *****************************/
    renderTiles();

    /*****************************
     * Demo: preload some demo wishes if storage empty (optional)
     *****************************/
    (function seedDemo() {
      const cur = loadLocal();
      if (cur.length === 0) {
        const now = Date.now();
        const seed = [
          { id: 's1', teacherId: 'gv1', name: 'Ng·ªçc', klass: '9/4', content: 'C·∫£m ∆°n th·∫ßy ƒë√£ d·∫°y t·ª•i em th·∫≠t t·∫≠n t√¢m! ‚ù§Ô∏è', hidden: false, ts: now - 3600 * 1000 },
          { id: 's2', teacherId: 'gv2', name: 'H√†', klass: '9/4', content: 'C·∫£m ∆°n c√¥ ƒë√£ truy·ªÅn c·∫£m h·ª©ng cho em v·ªõi vƒÉn h·ªçc!', hidden: false, ts: now - 2000 * 1000 }
        ];
        saveLocal(seed);
      }
    })();

    /*****************************
     * Accessibility: allow tiles focus + enter
     *****************************/
    tilesEl.addEventListener('keydown', (e) => {
      const t = e.target.closest('.tile');
      if (!t) return;
      if (e.key === 'Enter' || e.key === ' ') t.click();
    });

  </script>

</body>

</html>








